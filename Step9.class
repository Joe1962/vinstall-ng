' Gambas class file
'    This file is part of vinstall-ng

'    vinstall-ng is free software: you can redistribute it and/or modify
'    it under the terms of the GNU General Public License as published by
'    the Free Software Foundation, either version 2 of the License, or
'    (at your option) any later version.

'    vinstall-ng  is distributed in the hope that it will be useful,
'    but WITHOUT ANY WARRANTY; without even the implied warranty of
'    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
'    GNU General Public License for more details.

'    You should have received a copy of the GNU General Public License
'    along with vinstall-ng.  If not, see <http://www.gnu.org/licenses/>.



PUBLIC SUB Form_Open()

  
  ME.tlbanner.Text = "<h2>" & tlbanner.Text & "</h2>"
  ME.tlInstallWarn.Text = ClsGlobal.sDistroName & Space(1) & ClsGlobal.sDistroVer & Space(1)&
  ("is being installed to your computer. Please wait.")
  
  WAIT 1
  ME.Refresh
  WAIT 1
  ' MdlMain.CREATE_CREDIT_LABELS(ME.ScrlCredits) ' Fill out credits list
  'ME.tmScroll.Enabled = TRUE ' Start scrolling
  'FrmCredits.Reparent(ME.wsScroll)
  'FrmCredits.Show()
  ME.create_installation_process_layout() ' triggers installation process
  
  

END
PUBLIC FUNCTION GetNExt() AS String
  

  RETURN "Conf0"
  
END

PUBLIC SUB OnExit()
  
  
  
  
END
PUBLIC SUB StartUp()
  
  MdlMain.ADVANCE_STATUS_TREE("Step4", "Step5")
  ME.Resize(ME.Parent.Width, ME.Parent.Height)
  ME.Refresh()
  
END




PUBLIC SUB create_installation_process_layout()
  
  DIM tl AS TextLabel
  DIM pb AS PictureBox
  DIM i AS Integer
  DIM sStages AS String[] = [("Prepare Partitions"), ("Install Base System (required)"), ("Install User-Selected Software")]
  
  MdlMain.ADVANCE_STATUS_TREE("Step4", "Step5")
  ClsGlobal.fRunningMainForm.Refresh()
    FOR i = 0 TO sStages.Max
      pb = NEW PictureBox(ME.svInstallProc)
        WITH pb
          .Expand = FALSE
          .Resize(28, 28)
          .Picture = Picture.Load("images/square.png")
          .Tag = i
          '.Stretch = TRUE
        END WITH 
        MdlMain.$objPboxes.Add(pb)
      tl = NEW TextLabel(ME.svInstallProc)
        WITH tl
          .Text = sStages[i]
          .Height = 28
          '.Width = .Parent.Width - (.X * 2)
          .Alignment = Align.TopLeft
          .Expand = TRUE
          .Visible = TRUE
        END WITH 
  NEXT 
  
  ' Now start the installation process
  IF MdlMain.INSTALL_PACKAGES(tlcurrpkg, pbinstall, ClsGlobal.iInstallMethod) > 0 THEN 
    Message.Error(("Something went wrong during installation. Please try again"))
  ELSE 
    ' IF IsDir(ClsGlobal.sTargetPath &/ "boot") = FALSE THEN TRY MKDIR ClsGlobal.sTargetPath &/ "boot"
    ' IF MdlMain.INSTALL_KERNEL_AND_INITRD() THEN 
    '   Message.Error(("Error during kernel installation. Please see error log"))
    ' END IF
  END IF
  
  
END



PUBLIC SUB Form_Resize()

  ME.hbBottomPanel.Height = ME.ClientH - (ME.hbBottomPanel.top + 24)
  ME.svInstallProc.Width = svinstallproc.Parent.Width - (svinstallproc.left * 2)
  ME.svInstallProc.Height = svinstallproc.Parent.Height - (svinstallproc.top * 1.25)
  'ME.ScrlCredits.Move(4, 36, ScrlCredits.Parent.Width - (ScrlCredits.x * 2), ScrlCredits.Parent.Height - (ScrlCredits.Top * 1.5))
  ME.wsScroll.Move(4, 36, wsScroll.Parent.Width - (wsscroll.x * 2), wsscroll.Parent.Height - (wsscroll.top * 1.5))

END


' PUBLIC SUB tmScroll_Timer()
' 
'   'INC ScrollView1.ScrollY
'   'PRINT ScrollView1.scrolly & " |" & ScrollView1.ScrollH & " | " & ScrollView1.Height
'     'IF ScrollView1.ScrollY = ScrollView1.scrollh - ScrollView1.Height THEN ScrollView1.Scroll(0, 0)
'     INC ScrlCredits.ScrollY
'     IF ScrlCredits.ScrollY = ScrlCredits.ScrollH - ScrlCredits.Height THEN 
'       WAIT 2
'       ScrlCredits.Scroll(0, 0)
'     END IF
' 
' 
' END

PUBLIC SUB tmScroll_Timer()

  INC svInstallProc.ScrollY
  'IF ScrollView1.ScrollY = ScrollView1.scrollh - ScrollView1.Height THEN ScrollView1.Scroll(0, 0)
  IF svinstallproc.scrolly = svinstallproc.ScrollH - svinstallproc.Height THEN svinstallproc.Scroll(0, 0)

END
