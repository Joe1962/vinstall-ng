' Gambas class file
'    This file is part of vinstall-ng

'    vinstall-ng is free software: you can redistribute it and/or modify
'    it under the terms of the GNU General Public License as published by
'    the Free Software Foundation, either version 2 of the License, or
'    (at your option) any later version.

'    vinstall-ng  is distributed in the hope that it will be useful,
'    but WITHOUT ANY WARRANTY; without even the implied warranty of
'    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
'    GNU General Public License for more details.

'    You should have received a copy of the GNU General Public License
'    along with vinstall-ng.  If not, see <http://www.gnu.org/licenses/>.


PUBLIC FUNCTION GET_CURRENT_HOST_NAME() AS String
  DIM sRes AS String
  IF Exist("/etc/HOSTNAME") THEN 
    File.Save(Temp("Host"), SConv(File.load("/etc/HOSTNAME")))
    
    
    sRes = DConv(File.Load(Temp("Host")))
    
    'sRes = File.Load(DConv("/etc/HOSTNAME"))
      IF sRes = "" THEN 
        sRes = "Vector.Linux.net"
      END IF
  ELSE 
    sRes = "Vector.Linux.net"
  END IF
    RETURN sRes
      
END


PUBLIC SUB Form_Open()
    
    ME.txtHostName.text = ME.GET_CURRENT_HOST_NAME()
    MdlNetConf.LIST_NETWORK_INTERFACES
    cbUseManDNS.Value = FALSE
    tlBanner.text = "<h2>" & tlBanner.text & "</h2>"
  IF ERROR THEN Message(Error.text & "\n" & Error.where)
    
END


PUBLIC SUB Form_Menu()

  MdlNetConf.WRITE_INET()

END

PUBLIC SUB Form_Resize()
DIM itxtboxleft AS Integer

    WITH ME
      .tlBanner.Move(8, 10, MdlObjSizer.get_object_width(.tlBanner.text))
      .tlHostNameLbl.Move(.tlBanner.Left, .tlBanner.top + .tlBanner.Height + 8, MdlObjSizer.get_object_width(.tlHostNameLbl.text), 21)
      .txtHostName.Move(.tlHostNameLbl.left + .tlHostNameLbl.Width + 4, .tlHostNameLbl.top)
      .cbUseManDNS.Move(.tlHostNameLbl.Left, .tlHostNameLbl.top + .tlHostNameLbl.Height + 10, MdlObjSizer.get_object_width(.cbUseManDNS.text) + 24)
      .tlPrimaryDNS.Move(.cbUseManDNS.left, .cbUseManDNS.top + .cbUseManDNS.Height + 4, MdlObjSizer.get_object_width(.tlPrimaryDNS.text))
        itxtboxleft = .tlPrimaryDNS.Left + .tlPrimaryDNS.Width + 24
      .txtPrimaryDNS.Move(itxtboxleft, .tlPrimaryDNS.Top)
      .tlSecDNS.Move(.tlPrimaryDNS.Left, .tlPrimaryDNS.top + .tlPrimaryDNS.Height + 4, MdlObjSizer.get_object_width(.tlSecDNS.text))
      .txtSecDNS.Move(itxtboxleft, .tlSecDNS.top)
      ' now move the frame
      .frmNetDevices.Move(.tlSecDNS.Left, .tlSecDNS.top + .tlSecDNS.Height + 8)
        .frmNetDevices.Width = .ClientWidth - (.frmNetDevices.Left * 2)
      .TSNetDevices.Width = .ClientWidth - (.frmNetDevices.left * 5) 
      
  END WITH 
END

PUBLIC SUB cbUseManDNS_Click()

    ME.txtPrimaryDNS.Enabled = cbUseManDNS.Value
    ME.txtSecDNS.Enabled = cbUseManDNS.Value

END
