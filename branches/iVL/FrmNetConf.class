' Gambas class file
'    This file is part of vinstall-ng

'    vinstall-ng is free software: you can redistribute it and/or modify
'    it under the terms of the GNU General Public License as published by
'    the Free Software Foundation, either version 2 of the License, or
'    (at your option) any later version.

'    vinstall-ng  is distributed in the hope that it will be useful,
'    but WITHOUT ANY WARRANTY; without even the implied warranty of
'    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
'    GNU General Public License for more details.

'    You should have received a copy of the GNU General Public License
'    along with vinstall-ng.  If not, see <http://www.gnu.org/licenses/>.


PUBLIC FUNCTION GET_CURRENT_HOST_NAME() AS String
  DIM sRes AS String
  
    SHELL "hostname" TO sRes

    sRes = Trim(sRes)
      IF sRes = "" THEN 
        sRes = "Vector.Linux.net"
      END IF

    RETURN Trim(sRes)
      
END


PUBLIC SUB Form_Open()
  DIM cb AS ComboBox
    FMain.FrmCurr = ME
    
    
    WITH FMain 
    .tvPlan["Conf3"].Picture = MdlCore.sDonePic
    .tvPlan["Conf4"].Picture = MdlCore.sNowPic
    .tvPlan["Conf4"].Selected = TRUE
  END WITH 
    
    ME.txtHostName.text = ME.GET_CURRENT_HOST_NAME()
    MdlNetConf.LIST_NETWORK_INTERFACES()
    cbUseManDNS.Value = FALSE
    tlBanner.text = "<h3>" & tlBanner.text & "</h3>"
   
    
  IF ERROR THEN Message(Error.text & "\n" & Error.where)
  
  WAIT 
    FOR EACH cb IN MdlNetConf.objCombos
      cb.Refresh
    NEXT 
    ME.frmNetDevices.Text = Space(1) & ("Network Interfaces") & Space(1)
    
END


PUBLIC SUB Form_Menu()

  'MdlNetConf.WRITE_INET() ' only enabled for testing. THis will get triggered on the "next" button's click event
  'MdlNetConf.SET_DNS_ADDRESSES

END

PUBLIC SUB Form_Resize()
DIM itxtboxleft AS Integer

    WITH ME
      .tlBanner.Move(4, 8, .ClientWidth - (.tlBanner.left * 2))
      .hrSep.Move(4, .tlBanner.top + .tlBanner.Height - 4, .tlBanner.Width)
      .tlHostNameLbl.Move(.tlBanner.Left, .tlBanner.top + .tlBanner.Height + 8, MdlObjSizer.get_object_width(.tlHostNameLbl.text), 21)
      .txtHostName.Move(.tlHostNameLbl.left + .tlHostNameLbl.Width + 4, .tlHostNameLbl.top)
      .cbUseManDNS.Move(.tlHostNameLbl.Left, .tlHostNameLbl.top + .tlHostNameLbl.Height + 10, MdlObjSizer.get_object_width(.cbUseManDNS.text) + 24)
      .tlPrimaryDNS.Move(.cbUseManDNS.left, .cbUseManDNS.top + .cbUseManDNS.Height + 4, MdlObjSizer.get_object_width(.tlPrimaryDNS.text))
        itxtboxleft = .tlPrimaryDNS.Left + .tlPrimaryDNS.Width + 24
      .txtPrimaryDNS.Move(itxtboxleft, .tlPrimaryDNS.Top)
      .tlSecDNS.Move(.tlPrimaryDNS.Left, .tlPrimaryDNS.top + .tlPrimaryDNS.Height + 4, MdlObjSizer.get_object_width(.tlSecDNS.text))
      .txtSecDNS.Move(itxtboxleft, .tlSecDNS.top)
      ' now move the frame
      .frmNetDevices.Move(.tlSecDNS.Left, .tlSecDNS.top + .tlSecDNS.Height + 8, .ClientWidth - (.frmNetDevices.Left * 2), .ClientH - .frmNetDevices.top - 32)
      
      .TSNetDevices.Move(8, 20, .frmNetDevices.Width - (.TSNetDevices.Left * 2))
      .TSNetDevices.Height = .frmNetDevices.Height - (.TSNetDevices.y * 2)
    
      
  END WITH 
END

PUBLIC SUB cbUseManDNS_Click()

    ME.txtPrimaryDNS.Enabled = cbUseManDNS.Value
    ME.txtSecDNS.Enabled = cbUseManDNS.Value

END
