' Gambas class file
'    This file is part of vinstall-ng

'    vinstall-ng is free software: you can redistribute it and/or modify
'    it under the terms of the GNU General Public License as published by
'    the Free Software Foundation, either version 2 of the License, or
'    (at your option) any later version.

'    vinstall-ng  is distributed in the hope that it will be useful,
'    but WITHOUT ANY WARRANTY; without even the implied warranty of
'    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
'    GNU General Public License for more details.

'    You should have received a copy of the GNU General Public License
'    along with vinstall-ng.  If not, see <http://www.gnu.org/licenses/>.

PUBLIC objBulks AS Object[]
PUBLIC picYes AS Picture
PUBLIC picNo AS Picture
PUBLIC SUB Form_Open()

picYes = Picture.Load("images/16px-check.png")
picNo = Picture.Load("images/16px-Nocheck.png")
'btTglSel.Value = FALSE


  ME.tlbanner.Text = "<h2>" & ("Customize Your VectorLinux Installation") & "</h2>"
  WITH ME.gvBulkSel
    .Columns.count = 4
    .Rows.Count = 2
    '.Grid = FALSE
  END WITH 
  'gvBulkSel[0, 0].Text = 
  gvBulkSel[0, 1].text = ("Component")
  gvBulkSel[0, 1].Font.Bold = TRUE
  gvBulkSel[0, 0].BackColor = Color.LightBackground
  gvBulkSel.Columns[0].Width = 24
  gvBulkSel.Columns[1].Width = 150
  gvBulkSel.Columns[2].Width = 300
  gvBulkSel.Columns[3].Width = 1
  'gvBulkSel.Columns[3].Resizable = FALSE
  'gvBulkSel.Columns[2].Resizable = TRUE
  gvBulkSel.Rows[1].Height = 5
  'gvBulkSel[2, 0].BackColor = Color.LightBackground
  gvBulkSel[0, 1].BackColor = Color.LightBackground
  gvBulkSel[0, 2].BackColor = Color.LightBackground
  gvBulkSel[0, 3].BackColor = Color.LightBackground
  'gvBulkSel[0,3].ba
  gvBulkSel[0, 2].Text = ("Description")
  gvBulkSel[0, 2].Font.Bold = TRUE
  'WAIT 1
  ME.LIST_OPTIONAL_BULKS
END

PUBLIC FUNCTION GetNext() AS String
  
  RETURN "Step7b"
  
END

PUBLIC SUB LIST_OPTIONAL_BULKS()
  
  DIM sLine, sFile AS String '= File.Load("/mnt/source/veclinux/SETUP.CONF")
  DIM sArr, sLineArr AS String[]
  DIM i, irow AS Integer
  DIM sName, sDesc AS String
  

  
  irow = 2
  IF Exist("/mnt/source/veclinux/VINSTALL.CONF") THEN 
    sFile = File.Load("/mnt/source/veclinux/VINSTALL.CONF")
    sArr = Split(sFile, "\n")
      FOR i = 0 TO sArr.Max
        sLine = Trim(sArr[i])
        sLine = Trim(Right(sLine, Len(sLine) - InStr(sLine, "=")))
        sLine = Replace(sLine, "\'", "")
          IF InStr(sLine, "OPT") THEN 
          INC gvBulkSel.Rows.Count
            sLineArr = Split(sLine, ":")
            sName = Trim(sLineArr[1])
            sDesc = Trim(sLineArr[3])
            gvBulkSel[irow, 1].Text = Trim(sname)
            gvBulkSel[irow, 0].Picture = picYes
            gvBulkSel[irow, 2].Text = Trim(sDesc)
            gvBulkSel[irow, 3].Text = "yes"
          INC irow
          END IF
      NEXT   
        
        
  ELSE 
  END IF

  
END


PUBLIC SUB StartUp()
  
  
  
END

PUBLIC SUB Get_Bulk_Selection()
  
  DIM irow AS Integer
  DIM sList AS String
    FOR irow = 2 TO gvBulkSel.Rows.count - 1
      IF gvBulkSel[irow, 3].Text LIKE "yes" THEN 
        sList = sList & Trim(gvBulkSel[irow, 1].Text) & ","
      END IF
    NEXT 
  ClsGlobal.sBulkListToInstall = Trim(slist)
  'Message(ClsGlobal.sBulkListToInstall)
  
  
END


PUBLIC SUB OnExit()
  
  ME.Get_Bulk_Selection()
  
END


PUBLIC SUB Form_Resize()

  gvBulkSel.Columns[2].Width = gvBulkSel.Width - (gvBulkSel.ColumnAt(gvBulkSel[0, 2].Left) + gvBulkSel.Columns[1].Width + gvBulkSel.Columns[0].width + 4)
  'gvBulkSel.Columns[2].Width = gvBulkSel.Width - (gvBulkSel.Columns[0].Width + gvBulkSel.Columns[2].Width - gvBulkSel.Columns[3].Width)

END

PUBLIC SUB gvBulkSel_Click()

  'IF LAST.column > 0 THEN RETURN 
  IF LAST.column = 0 OR LAST.column = 1 AND LAST.row > 1 THEN 
    IF gvBulkSel[LAST.row, 0].Picture = picYes THEN 
        IF gvBulkSel[LAST.row, 1].text LIKE "x11" THEN 
          SELECT CASE Message.Warning("<b>" & ("WARNING:") & "</b>" & Space(1) & ("This component is a dependancy to any graphical user interface progam on the system") & "<br>" &
          ("Choosing not to install this may result in a command-line (text mode) installation only") & "<br>" &
          ("Are you sure you want to disable this conponent anyway?"), ("Yes"), ("No"))
            CASE 2
              RETURN 
              STOP EVENT 
          END SELECT 
        END IF
      gvBulkSel[LAST.row, 0].Picture = picNo
      gvBulkSel[LAST.row, 3].Text = "no"
    ELSE 
      gvBulkSel[LAST.row, 0].Picture = picYes
      gvBulkSel[LAST.row, 3].Text = "yes"
    END IF
  ELSE IF LAST.column = 2 THEN 
    Balloon(gvBulkSel[LAST.row, 2].Text, gvBulkSel, gvBulkSel[LAST.row, 0].picture, gvBulkSel[LAST.row, LAST.column].left + 4, gvBulkSel[LAST.row, LAST.column].y + 12)
  END IF
        
  gvBulkSel.Refresh
  

END

PUBLIC SUB btTglSel_Click()
  
    DIM irow AS Integer

  'IF LAST.value THEN 
  IF LAST.text = ("Select All") THEN 
      irow = 2  
        FOR irow = 2 TO gvBulkSel.Rows.count - 1
          gvBulkSel[irow, 0].Picture = picyes
          gvBulkSel[irow, 3].Text = "yes"
        NEXT         
    LAST.text = ("Un-Select All")
  ELSE 
    irow = 2
      FOR irow = 2 TO gvBulkSel.Rows.count - 1
        gvBulkSel[irow, 0].Picture = picno
        gvBulkSel[irow, 3].Text = "no"
      NEXT 
    LAST.text = ("Select All")
  END IF
gvBulkSel.Refresh
END
